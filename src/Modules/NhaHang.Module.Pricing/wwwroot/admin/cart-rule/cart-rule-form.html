<div id="kt_app_toolbar" class="app-toolbar py-3 py-lg-6">
    <div id="kt_app_toolbar_container" class="app-container container-xxl d-flex flex-stack">
        <div class="page-title d-flex flex-column justify-content-center flex-wrap me-3">
            <h1 class="page-heading d-flex text-dark fw-bold fs-3 flex-column justify-content-center my-0n" ng-if="!vm.isEditMode">
                {{::vm.translate.get('Create Cart Pricing Rule')}}
            </h1>
            <h1 class="page-heading d-flex text-dark fw-bold fs-3 flex-column justify-content-center my-0" ng-if="vm.isEditMode">
                {{::vm.translate.get('Edit Cart Pricing Rule')}} {{vm.cartRule.name}}
            </h1>
            <ul class="breadcrumb breadcrumb-separatorless fw-semibold fs-7 my-0 pt-1">
                <li class="breadcrumb-item text-muted">
                    <a href="admin" class="text-muted text-hover-primary">{{::vm.translate.get('Home')}}</a>
                </li>
                <li class="breadcrumb-item">
                    <span class="bullet bg-gray-400 w-5px h-2px"></span>
                </li>
                <li class="breadcrumb-item text-muted">
                    <a href="javascript:;" class="text-muted text-hover-primary">
                        {{::vm.translate.get('Promotions')}}
                    </a>
                </li>
                <li class="breadcrumb-item">
                    <span class="bullet bg-gray-400 w-5px h-2px"></span>
                </li>
                <li class="breadcrumb-item text-muted">
                    <a href="javascript:;" class="text-muted text-hover-primary">
                        {{::vm.translate.get('Cart Pricing Rule')}}
                    </a>
                </li>
                <li class="breadcrumb-item">
                    <span class="bullet bg-gray-400 w-5px h-2px"></span>
                </li>
                <li class="breadcrumb-item text-muted" ng-if="!vm.isEditMode">
                    {{::vm.translate.get('Create Cart Pricing Rule')}}
                </li>
                <li class="breadcrumb-item text-muted" ng-if="vm.isEditMode">
                    {{::vm.translate.get('Edit Cart Pricing Rule')}}
                </li>
            </ul>
        </div>
    </div>
</div>
<div id="kt_app_content" class="app-content flex-column-fluid">
    <div id="kt_app_content_container" class="app-container container-xxl">
        <form name="cartRuleForm" class="form-horizontal">
            <div class="d-flex flex-column flex-row-fluid gap-7 gap-lg-10">
                <ul class="nav nav-custom nav-tabs nav-line-tabs nav-line-tabs-2x border-0 fs-4 fw-semibold mb-n2">
                    <li class="nav-item">
                        <a class="nav-link text-active-primary pb-4 active" data-bs-toggle="tab" href="#General">{{::vm.translate.get('General Information')}}</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link pb-4" data-bs-toggle="tab" href="#Products_Selection">{{::vm.translate.get('Products Selection')}}</a>
                    </li>
                </ul>
                <div class="tab-content">
                    <div class="tab-pane fade show active" id="General" role="tab-panel">
                        <div class="card card-custom card-stretch gutter-b">
                            <div class="card-body pt-10">
                                <div class="alert alert-danger d-flex align-items-center p-5" ng-show="vm.validationErrors">
                                    <i class="ki-outline ki-call fs-2hx text-danger me-4"></i>
                                    <div class="d-flex flex-column">
                                        <h4 class="mb-1 text-danger" ng-repeat="error in vm.validationErrors">{{error}}</h4>
                                    </div>
                                </div>
                                <div class="mb-10">
                                    <label class="required form-label">{{::vm.translate.get('Name')}}</label>
                                    <input name="name" required ng-model="vm.cartRule.name" placeholder="{{::vm.translate.get('Name')}}" class="form-control" />
                                    <div class="text-muted fs-7">Set a meta tag title. Recommended to be simple and precise keywords.</div>
                                </div>
                                <div class="mb-10">
                                    <label class="form-label">{{::vm.translate.get('Description')}}</label>
                                    <textarea name="description" ng-model="vm.cartRule.description" rows="3" placeholder="{{::vm.translate.get('Description')}}" class="form-control"></textarea>
                                    <div class="text-muted fs-7">Set a meta tag title. Recommended to be simple and precise keywords.</div>
                                </div>
                                <div class="d-flex flex-wrap gap-5 mb-10">
                                    <div class="fv-row w-100 flex-md-root fv-plugins-icon-container">
                                        <label class="form-label">{{::vm.translate.get('Start')}}</label>
                                        <div class="input-group">
                                            <input type="text" placeholder="{{::vm.translate.get('Start')}}" class="form-control" datetime-picker="dd MMM yyyy HH:mm" ng-model="vm.cartRule.startOn" is-open="vm.datePickerStartOn.open" datepicker-options="vm.datePickerStartOn.datepickerOptions" />
                                            <div class="input-group-append">
                                                <button class="btn btn-light" type="button" ng-click="vm.openCalendar($event, 'datePickerStartOn')"> <i class="ki-duotone ki-calendar fs-2"><span class="path1"></span><span class="path2"></span></i></button>
                                            </div>
                                        </div>
                                        <div class="text-muted fs-7">{{::vm.translate.get('End')}}</div>
                                    </div>
                                    <div class="fv-row w-100 flex-md-root">
                                        <label class="form-label">{{::vm.translate.get('Usage limit per customer')}}</label>
                                        <div class="input-group">
                                            <input type="text" placeholder="{{::vm.translate.get('End')}}" class="form-control" datetime-picker="dd MMM yyyy HH:mm" ng-model="vm.cartRule.endOn" is-open="vm.datePickerEndOn.open" datepicker-options="vm.datePickerEndOn.datepickerOptions" />
                                            <div class="input-group-append">
                                                <button class="btn btn-light" type="button" ng-click="vm.openCalendar($event, 'datePickerEndOn')"><i class="ki-duotone ki-calendar fs-2"><span class="path1"></span><span class="path2"></span></i></button>
                                            </div>
                                        </div>
                                        <div class="text-muted fs-7">Set the product VAT about.</div>
                                    </div>
                                </div>
                                <div class="d-flex flex-wrap gap-5 mb-10">
                                    <div class="fv-row w-100 flex-md-root fv-plugins-icon-container">
                                        <label class="form-label">{{::vm.translate.get('Discount Amount')}}</label>
                                        <input name="discountAmount" ng-model="vm.cartRule.discountAmount" placeholder="{{::vm.translate.get('Discount Amount')}}" class="form-control" />
                                        <div class="text-muted fs-7">{{::vm.translate.get('End')}}</div>
                                    </div>
                                    <div class="fv-row w-100 flex-md-root">
                                        <label class="form-label">{{::vm.translate.get('Max Discount Amount')}}</label>
                                        <input name="maxDiscountAmount" ng-model="vm.cartRule.maxDiscountAmount" placeholder="{{::vm.translate.get('Max Discount Amount')}}" class="form-control" />
                                        <div class="text-muted fs-7">Set the product VAT about.</div>
                                    </div>
                                </div>
                                <div class="d-flex flex-wrap gap-5 mb-10">
                                    <div class="fv-row w-100 flex-md-root fv-plugins-icon-container">
                                        <label class="form-label">Tax Class</label>
                                        <input name="usageLimitPerCustomer" ng-model="vm.cartRule.usageLimitPerCustomer" placeholder="{{::vm.translate.get('Usage limit per customer')}}" class="form-control" />
                                        <div class="text-muted fs-7">Set the product tax class.</div>
                                    </div>
                                    <div class="fv-row w-100 flex-md-root">
                                        <label class="required form-label">{{::vm.translate.get('Usage limit per customer')}}</label>
                                        <select required class="form-select" ng-model="vm.cartRule.ruleToApply">
                                            <option value="cart_fixed">{{::vm.translate.get('Fixed amount discount for whole cart')}}</option>
                                            <option value="by_percent">{{::vm.translate.get('Percent of product price discount')}}</option>
                                            <option value="buy_x_get_y">{{::vm.translate.get('Buy X Get Y Free (discount amount is Y)')}}</option>
                                        </select>
                                        <div class="text-muted fs-7">Set the product VAT about.</div>
                                    </div>
                                </div>
                                <div ng-show="vm.cartRule.ruleToApply == 'buy_x_get_y'" class="mb-10">
                                    <label class="form-label">{{::vm.translate.get('Discount Step (Buy X)')}}</label>
                                    <input name="discountStep" ng-model="vm.cartRule.discountStep" placeholder="{{::vm.translate.get('Discount Step (Buy X)')}}" class="form-control" />
                                    <div class="text-muted fs-7">Set a meta tag title. Recommended to be simple and precise keywords.</div>
                                </div>
                                <div class="mb-10">
                                    <label class="form-label">{{::vm.translate.get('Require coupon code')}}</label>
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" role="switch" ng-model="vm.cartRule.isCouponRequired">
                                        <label class="form-check-label">{{::vm.translate.get('Require coupon code')}}</label>
                                    </div>
                                    <div class="text-muted fs-7">Set a meta tag title. Recommended to be simple and precise keywords.</div>
                                </div>
                                <div ng-show="vm.cartRule.isCouponRequired" class="d-flex flex-wrap gap-5 mb-10">
                                    <div class="fv-row w-100 flex-md-root fv-plugins-icon-container">
                                        <label class="form-label">{{::vm.translate.get('Coupon Code')}}</label>
                                        <input name="couponCode" ng-model="vm.cartRule.couponCode" placeholder="{{::vm.translate.get('Coupon Code')}}" class="form-control" />
                                        <div class="text-muted fs-7">{{::vm.translate.get('End')}}</div>
                                    </div>
                                    <div class="fv-row w-100 flex-md-root">
                                        <label class="form-label">{{::vm.translate.get('Usage limit per coupon')}}</label>
                                        <input name="usageLimitPerCoupon" ng-model="vm.cartRule.usageLimitPerCoupon" placeholder="{{::vm.translate.get('Usage limit per coupon')}}" class="form-control" />
                                        <div class="text-muted fs-7">Set the product VAT about.</div>
                                    </div>
                                </div>
                                <div class="mb-10">
                                    <label class="form-label">{{::vm.translate.get('Is Active')}}</label>
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" role="switch" ng-model="vm.cartRule.isActive">
                                        <label class="form-check-label">{{::vm.translate.get('Is Active')}}</label>
                                    </div>
                                    <div class="text-muted fs-7">Set a meta tag title. Recommended to be simple and precise keywords.</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="tab-pane fade" id="Products_Selection" role="tab-panel">
                        <div class="card card-flush py-4">
                            <div class="card-body">
                                {{::vm.translate.get('Select products to apply or leave blank for all products')}}
                                <product-selection-directive model-id="productsSelector" title="{{::vm.translate.get('Add products')}}" selected-products="vm.cartRule.products"></product-selection-directive>
                                <button type="button" class="btn btn-light mb-10" data-bs-toggle="modal" data-target="#productsSelector">{{::vm.translate.get('Manage Products Selection')}}</button>
                                <div class="table-responsive">
                                    <table class="table align-middle table-row-dashed">
                                        <thead>
                                             <tr class="fs-6 fw-bold text-gray-600">
                                                <th>{{::vm.translate.get('Name')}}</th>
                                                <th class="text-center">{{::vm.translate.get('Is Published')}}</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr ng-repeat="product in vm.cartRule.products">
                                                <td>{{product.name}}</td>
                                                <td class="text-center"><i ng-attr-class="{{product.isPublished && 'la la-toggle-on text-primary' || 'la la-toggle-off'}}"></i></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="form-group row">
                    <div class="col-sm-12 text-center">
                        <button class="btn btn-primary" ng-disabled="cartRuleForm.$invalid" ng-click="vm.save()">
                            <span class="indicator-label" ng-hide="vm.showProgress">{{::vm.translate.get('Save Changes')}}</span>
                            <span ng-show="vm.showProgress">
                                {{::vm.translate.get('Please wait...')}}
                                <span class="spinner-border spinner-border-sm align-middle ms-2"></span>
                            </span>
                        </button>
                        <button ui-sref="cart-rules" class="btn btn-light-danger"><i class="la la-close mr-1"></i>{{::vm.translate.get('Cancel')}}</button>
                    </div>
                </div>
            </div>
        </form>
    </div>
</div>

