
<div id="kt_app_toolbar" class="app-toolbar py-3 py-lg-6">
    <div id="kt_app_toolbar_container" class="app-container container-xxl d-flex flex-stack">
        <div class="page-title d-flex flex-column justify-content-center flex-wrap me-3">
            <h1 class="page-heading d-flex text-dark fw-bold fs-3 flex-column justify-content-center my-0n">
                {{::vm.translate.get('Create Order')}}
            </h1>
            <ul class="breadcrumb breadcrumb-separatorless fw-semibold fs-7 my-0 pt-1">
                <li class="breadcrumb-item text-muted">
                    <a href="admin" class="text-muted text-hover-primary">{{::vm.translate.get('Home')}}</a>
                </li>
                <li class="breadcrumb-item">
                    <span class="bullet bg-gray-400 w-5px h-2px"></span>
                </li>
                <li class="breadcrumb-item text-muted">
                    <a href="javascript:;" class="text-muted text-hover-primary">
                        {{::vm.translate.get('Order')}}
                    </a>
                </li>
                <li class="breadcrumb-item">
                    <span class="bullet bg-gray-400 w-5px h-2px"></span>
                </li>
                <li class="breadcrumb-item text-muted">
                    {{::vm.translate.get('Create Order')}}
                </li>
            </ul>
        </div>
    </div>
</div>
<div id="kt_app_content" class="app-content flex-column-fluid">
    <div id="kt_app_content_container" class="app-container container-xxl">
        <form name="orderForm" novalidate class="form-horizontal">
            <div class="card card-flush py-4 mb-5">
                <div class="card-header">
                    <div class="card-title">
                        <h2>{{::vm.translate.get('Customer')}}</h2>
                    </div>
                </div>
                <div class="card-body pt-0">
                    <div class="row mb-5">
                        <div class="col-xl-2">
                            <div class="fs-6 fw-semibold mt-2 mb-3">{{::vm.translate.get('Users')}}</div>
                        </div>
                        <div class="col-xl-7 fv-row fv-plugins-icon-container">
                            <div class="position-relative">
                                <i class="ki-outline ki-user fs-3 text-gray-500 position-absolute top-50 translate-middle ms-6">
                                </i>
                                <input name="customer-search" ng-model="vm.customer.fullName" ng-change="vm.searchCustomers()" placeholder="{{::vm.translate.get('Search user...')}}" class="form-control ps-10" autocomplete="off" />
                            </div>
                            <div id="search-users-results" ng-show="vm.isSearchingCustomers">
                                <div class="users" ng-repeat="user in vm.searchedCustomers" ng-click="vm.selectCustomer(user)">
                                    <div class="d-flex align-items-center">
                                        <div class="me-5 position-relative">
                                            <div class="symbol symbol-35px symbol-circle">
                                                <img alt="{{user.fullName}}" src="/_Content/NhaHang.Module.Core/image/blank.png">
                                            </div>
                                        </div>
                                        <div class="d-flex flex-column justify-content-center">
                                            <a href="" class="mb-1 text-gray-800 text-hover-primary">{{user.fullName}}</a>
                                            <div class="fw-semibold fs-6 text-gray-400">{{user.email}}</div>
                                        </div>
                                        <span class="badge badge-light text-muted">{{user.phoneNumber}}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row mb-5">
                        <div class="col-xl-2">
                            <div class="fs-6 fw-semibold mt-2 mb-3">{{::vm.translate.get('Customer Name')}}</div>
                        </div>
                        <div class="col-xl-7 fv-row fv-plugins-icon-container">
                            <div class="position-relative">
                                <i class="ki-outline ki-people fs-3 text-gray-500 position-absolute top-50 translate-middle ms-6">
                                </i>
                                <input name="customer-name" ng-model="vm.customer.fullName" placeholder="{{::vm.translate.get('Customer Name')}}" class="form-control ps-10" />
                            </div>
                        </div>
                    </div>
                    <div class="row mb-5">
                        <div class="col-xl-2">
                            <div class="fs-6 fw-semibold mt-2 mb-3">{{::vm.translate.get('Customer Email')}}</div>
                        </div>
                        <div class="col-xl-7 fv-row fv-plugins-icon-container">
                            <div class="position-relative">
                                <i class="ki-outline ki-sms fs-3 text-gray-500 position-absolute top-50 translate-middle ms-6">
                                </i>
                                <input name="customer-email" ng-model="vm.customer.email" placeholder="{{::vm.translate.get('Customer Email')}}" class="form-control ps-10" />
                            </div>
                        </div>
                    </div>
                    <div class="row mb-5">
                        <div class="col-xl-2">
                            <div class="fs-6 fw-semibold mt-2 mb-3">{{::vm.translate.get('Customer Phone')}}</div>
                        </div>
                        <div class="col-xl-7 fv-row fv-plugins-icon-container">
                            <div class="position-relative">
                                <i class="ki-outline ki-delivery-24 fs-3 text-gray-500 position-absolute top-50 translate-middle ms-6">
                                </i>
                                <input name="customer-phone" ng-model="vm.customer.phoneNumber" placeholder="{{::vm.translate.get('Customer Phone')}}" class="form-control ps-10" />
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card card-flush py-4 mb-5" ng-show="vm.customer.id">
                <div class="card-header">
                    <div class="card-title">
                        <h2>{{::vm.translate.get('Add Product')}}</h2>
                    </div>
                </div>
                <div class="card-body pt-0">
                    <div class="d-flex align-items-center">
                        <div class="position-relative w-md-200px me-md-2">
                            <i class="ki-outline ki-parcel-tracking fs-3 text-gray-500 position-absolute top-50 translate-middle ms-6">
                            </i>
                            <input placeholder="{{::vm.translate.get('Product Id')}}" class="form-control ps-10" ng-model="vm.addingProduct.id" />
                        </div>
                        <div class="position-relative w-md-400px me-md-2">
                            <i class="ki-outline ki-search-list fs-3 text-gray-500 position-absolute top-50 translate-middle ms-6">
                            </i>
                            <input placeholder="{{::vm.translate.get('search by product name')}}" class="form-control ps-10" ng-model="vm.addingProduct.name" ng-change="vm.searchProducts()" />
                            <div id="search-products-results" ng-show="vm.isSearchingProducts">
                                <div class="products" ng-repeat="product in vm.searchedProducts" ng-click="vm.selectProduct(product)">
                                    <div class="d-flex align-items-center">
                                        <span class="badge badge-light-success me-auto">{{product.id}}</span>
                                        <div class="d-flex flex-column flex-grow-1 font-weight-bold ps-10">
                                            <a class="text-dark text-hover-primary mb-1 font-size-lg">{{product.name}}</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="d-flex align-items-center">
                            <button class="btn btn-light-primary" ng-click="vm.addProduct()"><i class="la la-plus icon-lg mr-1"></i>{{::vm.translate.get('Add Product')}}</button>
                        </div>
                    </div>
                    <div class="separator separator-dashed mt-9 mb-6"></div>
                    <div class="table-responsive">
                        <table class="table align-middle table-row-dashed">
                            <thead>
                                 <tr class="fs-6 fw-bold text-gray-600">
                                    <th class="w-150px">{{::vm.translate.get('Product Id')}}</th>
                                    <th class="min-w-400px">{{::vm.translate.get('Product Name')}}</th>
                                    <th class="w-200px">{{::vm.translate.get('Price')}}</th>
                                    <th class="w-150px">{{::vm.translate.get('Quantity')}}</th>
                                    <th class="w-150px">{{::vm.translate.get('Actions')}}</th>
                                </tr>
                            </thead>
                            <tbody class="fw-semibold text-gray-600">
                                <tr ng-repeat="item in vm.cart.items">
                                    <td class="text-gray-800 text-hover-primary fw-bold">{{item.productId}}</td>
                                    <td class="text-gray-800 text-hover-primary fw-bold">{{item.productName}}</td>
                                    <td class="text-gray-800 text-danger fw-bold">{{item.productPrice | number}}</td>
                                    <td><input type="number" placeholder="{{::vm.translate.get('Product Id')}}" class="form-control" ng-change="vm.updateCartItemQuantity(item)" ng-model="item.quantity" /></td>
                                    <td><button ng-click="vm.removeCartItem(item)" class="btn btn-clean btn-icon delete"><i class="ki-outline ki-trash fs-2x text-danger"></i></button></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="d-flex flex-column flex-xl-row gap-3 gap-lg-3 mb-5" ng-show="vm.customer.id && vm.cart.items.length > 0">
                <div class="card card-flush py-4 flex-row-fluid position-relative">
                    <div class="position-absolute top-0 end-0 bottom-0 opacity-10 d-flex align-items-center me-5">
                        <i class="ki-solid ki-delivery" style="font-size: 13em">
                        </i>
                    </div>
                    <div class="card-header">
                        <div class="card-title">
                            <h2>{{::vm.translate.get('Shipping address')}}</h2>
                        </div>
                    </div>
                    <div class="card-body pt-0">
                        <label ng-repeat="address in vm.customerAddress.addresses" class="btn btn-outline btn-outline-dashed btn-active-light-primary d-flex text-start p-6" data-kt-button="true">
                            <span class="form-check form-check-custom form-check-solid form-check-sm align-items-start mt-1">
                                <input class="form-check-input" type="radio" ng-change="vm.updateTaxAndShippingPrice()" name="shippingAddressId" value="{{address.userAddressId}}" ng-model="vm.selectedShippingAddressId">
                            </span>
                            <span class="ms-5">
                                <span class="fs-4 fw-bold mb-1 d-block"> {{address.contactName}}</span>
                                <span class="fs-4 fw-bold mb-1 d-block">  {{address.phone}}</span>
                                <span class="fw-semibold fs-7 text-gray-600">
                                    {{address.addressLine1}} <br />{{address.addressLine2}}
                                </span>
                            </span>
                        </label>
                    </div>
                </div>

                <div class="card card-flush py-4 flex-row-fluid position-relative">
                    <div class="card-header">
                        <label class="btn btn-outline btn-outline-dashed btn-active-light-primary d-flex text-start p-6" data-kt-button="true">
                            <span class="form-check form-check-custom form-check-solid form-check-sm align-items-start mt-1">
                                <input class="form-check-input" type="radio" ng-change="vm.updateTaxAndShippingPrice()" name="shippingAddressId" ng-model="vm.selectedShippingAddressId" value="0" />
                            </span>
                            <span class="ms-5">
                                <span class="fs-4 fw-bold mb-1 d-block">  {{::vm.translate.get('Add another address')}}</span>
                            </span>
                        </label>
                    </div>
                    <div class="card-body pt-0">
                        <div class="pl-10" ng-show="vm.selectedShippingAddressId == 0">
                            <div class="d-flex flex-column flex-md-row gap-5 mb-5">
                                <div class="fv-row flex-row-fluid fv-plugins-icon-container">
                                    <label class="required form-label">{{::vm.translate.get('Country')}}</label>
                                    <select required class="form-select" ng-model="vm.shippingAddress.countryId" ng-change="vm.onCountrySelected(vm.shippingAddress.countryId)" ng-options="country.id as country.name for country in vm.countries"></select>
                                </div>

                                <div class="flex-row-fluid">
                                    <label class="form-label required">{{::vm.translate.get('State Or Province')}}</label>
                                    <select required class="form-select" ng-model="vm.shippingAddress.stateOrProvinceId" ng-change="vm.onStateOrProvinceSelected(vm.shippingAddress.stateOrProvinceId)" ng-options="stateOrProvince.id as stateOrProvince.name for stateOrProvince in vm.countryStatesOrProvinces.statesOrProvinces"></select>
                                </div>
                            </div>
                            <div class="d-flex flex-column flex-md-row gap-5 mb-5">
                                <div class="flex-row-fluid" ng-show="vm.countryStatesOrProvinces.isDistrictEnabled">
                                    <label class="form-label">{{::vm.translate.get('District')}}</label>
                                    <select class="form-control" ng-change="vm.updateTaxAndShippingPrice()" ng-model="vm.shippingAddress.districtId" ng-options="district.id as district.name for district in vm.districts">
                                        <option value="0">None</option>
                                    </select>
                                </div>
                                <div class="fv-row flex-row-fluid fv-plugins-icon-container" ng-show="vm.countryStatesOrProvinces.isZipCodeEnabled">
                                    <label class="required form-label">{{::vm.translate.get('Postal Code')}}</label>
                                    <input name="type" ng-change="vm.updateTaxAndShippingPrice()" ng-model="vm.shippingAddress.zipCode" placeholder="{{::vm.translate.get('Postal Code')}}" class="form-control" />
                                </div>
                                <div class="fv-row flex-row-fluid fv-plugins-icon-container" ng-show="vm.countryStatesOrProvinces.isCityEnabled">
                                    <label class="required form-label">{{::vm.translate.get('City')}}</label>
                                    <input name="type" ng-model="vm.shippingAddress.city" placeholder="{{::vm.translate.get('City')}}" class="form-control" />
                                </div>
                            </div>
                            <div class="d-flex flex-column flex-md-row gap-5 mb-5">
                                <div class="flex-row-fluid">
                                    <label class="form-label">{{::vm.translate.get('Address')}}</label>
                                    <input name="type" required ng-model="vm.shippingAddress.addressLine1" placeholder="{{::vm.translate.get('Address Line 1')}}" class="form-control" />
                                </div>

                                <div class="fv-row flex-row-fluid fv-plugins-icon-container">
                                    <label class="required form-label">{{::vm.translate.get('Contact Name')}}</label>
                                    <input name="code" required ng-model="vm.shippingAddress.contactName" placeholder="{{::vm.translate.get('Contact Name')}}" class="form-control" />
                                </div>

                                <div class="fv-row flex-row-fluid fv-plugins-icon-container">
                                    <label class="required form-label">{{::vm.translate.get('Phone')}}</label>
                                    <input name="type" required ng-model="vm.shippingAddress.phone" placeholder="{{::vm.translate.get('Phone')}}" class="form-control" />
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row g-5 gx-xl-10 mb-5 mb-xl-10" ng-show="vm.customer.id && vm.cart.items.length > 0">
                <div class="col-xxl-6 mb-5 mb-xl-10">
                    <div class="card card-flush h-xl-100">
                        <div class="card-body">
                            <div class="card-title mb-10">
                                <h2> {{::vm.translate.get('Shipping options')}}</h2>
                            </div>
                            <label ng-repeat="option in vm.shippingOptions" class="btn btn-outline btn-outline-dashed btn-active-light-primary d-flex text-start p-6" data-kt-button="true">
                                <span class="form-check form-check-custom form-check-solid form-check-sm align-items-start mt-1">
                                    <input class="form-check-input" type="radio" ng-change="vm.updateTaxAndShippingPrice()" ng-model="vm.selectedShippingOption" value="{{option.name}}" />
                                </span>
                                <span class="ms-5">
                                    <span class="fs-4 fw-bold mb-1 d-block"> {{option.name}}</span>
                                    <span class="fs-4 fw-bold mb-1 d-block"> {{option.priceText}}</span>
                                    <span class="fw-semibold fs-7 text-gray-600">
                                        {{::vm.translate.get('Estimated 14-20 Day Shipping (Duties and taxes may be due upon delivery)')}}
                                    </span>
                                </span>
                            </label>
                        </div>
                    </div>
                </div>
                <div class="col-xxl-6 mb-5 mb-xl-10">
                    <div class="card card-flush h-xl-100">
                        <div class="card-body">
                            <div class="card-title mb-10">
                                <h2> {{::vm.translate.get('Order note')}}</h2>
                            </div>
                            <textarea name="note" class="form-control" rows="3" ng-model="vm.cart.orderNote"></textarea>
                        </div>
                    </div>
                </div>
            </div>
            <div class="card card-flush py-4 flex-row-fluid overflow-hidden">
                <div class="card-header">
                    <div class="card-title">
                        <h2>{{::vm.translate.get('Order summary')}}</h2>
                    </div>
                </div>
                <div class="card-body pt-0">
                    <div class="table-responsive">
                        <table class="table align-middle table-row-dashed fs-6 gy-5 mb-0">
                            <thead>
                                 <tr class="fs-6 fw-bold text-gray-600">
                                    <th class="min-w-175px">{{::vm.translate.get('Product')}}</th>
                                    <th class="min-w-100px text-end">{{::vm.translate.get('SKU')}}</th>
                                    <th class="min-w-70px text-end">{{::vm.translate.get('Quantity')}}</th>
                                    <th class="min-w-100px text-end">{{::vm.translate.get('Price')}}</th>
                                    <th class="min-w-100px text-end">{{::vm.translate.get('Total')}}</th>
                                </tr>
                            </thead>
                            <tbody class="fw-semibold text-gray-600">
                                <tr ng-repeat="item in vm.cart.items">
                                    <td>{{item.productName}}</td>
                                    <td class="text-end">{{item.productSKU}}</td>
                                    <td class="text-end">{{item.quantity}}</td>
                                    <td class="text-end">{{item.productPriceString}}</td>
                                    <td class="text-end">{{item.totalString}}</td>
                                </tr>
                                <tr>
                                    <td colspan="4" class="text-end">
                                        {{::vm.translate.get('Subtotal:')}}
                                    </td>
                                    <td class="text-end">
                                        {{vm.cart.subTotalString}}
                                    </td>
                                </tr>
                                <tr>
                                    <td colspan="4" class="text-end">
                                        {{::vm.translate.get('Shipping:')}}
                                    </td>
                                    <td class="text-end">
                                        {{vm.cart.shippingAmountString}}
                                    </td>
                                </tr>
                                <tr>
                                    <td colspan="4" class="text-end">
                                        {{::vm.translate.get('Disount:')}}
                                    </td>
                                    <td class="text-end">
                                        {{vm.cart.discountString}}
                                    </td>
                                </tr>
                                <tr>
                                    <td colspan="4" class="text-end">
                                        {{::vm.translate.get('Tax:')}}
                                    </td>
                                    <td class="text-end">
                                        {{vm.cart.taxAmountString}}
                                    </td>
                                </tr>
                                <tr>
                                    <td colspan="4" class="fs-3 text-dark text-end">
                                        {{::vm.translate.get('Order Total:')}}
                                    </td>
                                    <td class="text-dark fs-3 fw-bolder text-end">
                                        {{vm.cart.orderTotalString}}
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="row mt-5">
                <div class="d-flex justify-content-end">
                    <a ui-sref="order" class="btn btn-light-danger me-5"><i class="la la-close mr-1"></i> {{::vm.translate.get('Cancel')}}</a>
                    <button class="btn btn-primary" ng-disabled="!vm.selectedShippingOption || vm.cart.items.length === 0 || (vm.selectedShippingAddressId === '0' &&  orderForm.$invalid)" ng-click="vm.createOrder()">
                        <span class="indicator-label" ng-hide="vm.showProgress">{{::vm.translate.get('Create Order')}}</span>
                        <span ng-show="vm.showProgress">
                            {{::vm.translate.get('Please wait...')}}
                            <span class="spinner-border spinner-border-sm align-middle ms-2"></span>
                        </span>
                    </button>
                </div>
            </div>
        </form>
    </div>
</div>